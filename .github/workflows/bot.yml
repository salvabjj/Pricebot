name: PriceBot Pro Max 24h

on:
  schedule:
    # Correção: O robô roda a cada 20 minutos
    - cron: '*/20 * * * *'
  workflow_dispatch: # Permite rodar manualmente no botão "Run Workflow"

jobs:
  executar-bot:
    runs-on: ubuntu-latest
    
    # Permissões para que o GitHub Actions possa salvar o histórico de volta no repo
    permissions:
      contents: write

    steps:
      - name: 1. Checkout do Repositório
        uses: actions/checkout@v3

      - name: 2. Configurar Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: 3. Instalar Dependências
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 python-telegram-bot==13.15

      - name: 4. Executar o Robô Minerador
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        # IMPORTANTE: Aqui o nome deve ser igual ao seu arquivo principal
        run: python Bot.py

      - name: 5. Salvar Histórico (Commit e Push)
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git add History.json
          git commit -m "bot: atualizando histórico [skip ci]" || echo "Sem novos links"
          git push
