import os
import asyncio
from playwright.async_api import async_playwright
from telegram import Bot

async def monitorar_e_printar():
    # Configura√ß√µes
    token = os.getenv("TELEGRAM_TOKEN")
    chat_id = os.getenv("CHAT_ID")
    bot = Bot(token=token)
    
    # URL alvo (Exemplo: Se√ß√£o de ofertas ou produto espec√≠fico)
    url = "https://www.mercadolivre.com.br/ofertas"

    async with async_playwright() as p:
        # Inicia o navegador (Headless para rodar no GitHub)
        browser = await p.chromium.launch(headless=True)
        context = await browser.new_context(
            user_agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36"
        )
        page = await context.new_page()
        
        print(f"üì° Acessando: {url}")
        try:
            # Vai at√© a p√°gina e espera os pre√ßos carregarem
            await page.goto(url, wait_until="networkidle", timeout=60000)
            await asyncio.sleep(5) # Tempo extra para garantir o carregamento do JS
            
            # Tira o Print Screen
            screenshot_path = "print_oferta.png"
            await page.screenshot(path=screenshot_path, full_page=False)
            
            # Envia via API do Telegram
            with open(screenshot_path, 'rb') as photo:
                await bot.send_photo(
                    chat_id=chat_id, 
                    photo=photo, 
                    caption="üì∏ **Nova Oferta Monitorada!**\nVerifique os pre√ßos atualizados no link abaixo."
                )
            print("‚úÖ Captura enviada ao Telegram!")
            
        except Exception as e:
            print(f"‚ùå Erro na captura: {e}")
        finally:
            await browser.close()

if __name__ == "__main__":
    asyncio.run(monitorar_e_printar())          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: python Bot.py

      - name: üíæ Salvar Hist√≥rico de Ofertas
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "action@github.com"
          git add History.json
          # S√≥ faz o commit se houver mudan√ßas para n√£o dar erro
          git diff --quiet && git diff --staged --quiet || (git commit -m "üìä Hist√≥rico atualizado [skip ci]" && git push)
