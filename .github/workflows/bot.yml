name: PriceBot Pro Max 24h

on:
  schedule:
    # Roda a cada 20 minutos (Padrão: minuto 0, 20 e 40 de cada hora)
    - cron: '*/20 * * * *'
  workflow_dispatch: # Permite que você rode manualmente pelo botão "Run Workflow"

jobs:
  executar-bot:
    runs-on: ubuntu-latest
    
    # Permissões necessárias para o robô salvar o histórico no seu repositório
    permissions:
      contents: write

    steps:
      - name: 1. Checkout do Repositório
        uses: actions/checkout@v3

      - name: 2. Configurar Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: 3. Instalar Dependências
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 python-telegram-bot==13.15

      - name: 4. Executar o Robô Minerador
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: python Bot.py

      - name: 5. Salvar Histórico (Commit e Push)
        # Este passo evita que o robô poste o mesmo produto na próxima rodada
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git add history.json
          # O comando abaixo evita erro se não houver novos links para salvar
          git commit -m "bot: atualizando histórico de envios [skip ci]" || echo "Sem novos links para salvar"
          git push
